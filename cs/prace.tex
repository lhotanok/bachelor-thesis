%%% Hlavní soubor. Zde se definují základní parametry a odkazuje se na ostatní části. %%%

%% Verze pro jednostranný tisk:
% Okraje: levý 40mm, pravý 25mm, horní a dolní 25mm
% (ale pozor, LaTeX si sám přidává 1in)
\documentclass[12pt,a4paper]{report}
\setlength\textwidth{145mm}
\setlength\textheight{247mm}
\setlength\oddsidemargin{15mm}
\setlength\evensidemargin{15mm}
\setlength\topmargin{0mm}
\setlength\headsep{0mm}
\setlength\headheight{0mm}
% \openright zařídí, aby následující text začínal na pravé straně knihy
\let\openright=\clearpage

%% Pokud tiskneme oboustranně:
% \documentclass[12pt,a4paper,twoside,openright]{report}
% \setlength\textwidth{145mm}
% \setlength\textheight{247mm}
% \setlength\oddsidemargin{14.2mm}
% \setlength\evensidemargin{0mm}
% \setlength\topmargin{0mm}
% \setlength\headsep{0mm}
% \setlength\headheight{0mm}
% \let\openright=\cleardoublepage

%% Vytváříme PDF/A-2u
\usepackage[a-2u]{pdfx}

%% Přepneme na českou sazbu a fonty Latin Modern
\usepackage[czech]{babel}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage{textcomp}

%% Použité kódování znaků: obvykle latin2, cp1250 nebo utf8:
\usepackage[utf8]{inputenc}

%%% Další užitečné balíčky (jsou součástí běžných distribucí LaTeXu)
\usepackage{amsmath}        % rozšíření pro sazbu matematiky
\usepackage{amsfonts}       % matematické fonty
\usepackage{amsthm}         % sazba vět, definic apod.
\usepackage{bbding}         % balíček s nejrůznějšími symboly
			    % (čtverečky, hvězdičky, tužtičky, nůžtičky, ...)
\usepackage{bm}             % tučné symboly (příkaz \bm)
\usepackage{graphicx}       % vkládání obrázků
\usepackage{fancyvrb}       % vylepšené prostředí pro strojové písmo
\usepackage{indentfirst}    % zavede odsazení 1. odstavce kapitoly
\usepackage{natbib}         % zajištuje možnost odkazovat na literaturu
			    % stylem AUTOR (ROK), resp. AUTOR [ČÍSLO]
\usepackage[nottoc]{tocbibind} % zajistí přidání seznamu literatury,
                            % obrázků a tabulek do obsahu
\usepackage{icomma}         % inteligetní čárka v matematickém módu
\usepackage{dcolumn}        % lepší zarovnání sloupců v tabulkách
\usepackage{booktabs}       % lepší vodorovné linky v tabulkách
\usepackage{paralist}       % lepší enumerate a itemize
\usepackage{xcolor}         % barevná sazba

%%% Údaje o práci

% Název práce v jazyce práce (přesně podle zadání)
\def\NazevPrace{Webová aplikace pro vyhledávání receptů}

% Název práce v angličtině
\def\NazevPraceEN{Web application for searching recipes}

% Jméno autora
\def\AutorPrace{Kristýna Lhoťanová}

% Rok odevzdání
\def\RokOdevzdani{2022}

% Název katedry nebo ústavu, kde byla práce oficiálně zadána
% (dle Organizační struktury MFF UK, případně plný název pracoviště mimo MFF)
\def\Katedra{Katedra softwarového inženýrství}
\def\KatedraEN{Department of Software Engineering}

% Jedná se o katedru (department) nebo o ústav (institute)?
\def\TypPracoviste{Katedra}
\def\TypPracovisteEN{Department}

% Vedoucí práce: Jméno a příjmení s~tituly
\def\Vedouci{doc. Mgr. Martin Nečaský, Ph.D.}

% Pracoviště vedoucího (opět dle Organizační struktury MFF)
\def\KatedraVedouciho{Katedra softwarového inženýrství}
\def\KatedraVedoucihoEN{Department of Software Engineering}

% Studijní program a obor
\def\StudijniProgram{Informatika}
\def\StudijniObor{Programování a vývoj software}

% Nepovinné poděkování (vedoucímu práce, konzultantovi, tomu, kdo
% zapůjčil software, literaturu apod.)
\def\Podekovani{%
Děkuji svému vedoucímu doc. Mgr. Martinovi Nečaskému, Ph.D. za vedení této práce, zejména za cenné rady v oblasti návrhu architektury a přístupu k implementaci, které uplatním i v nadcházejících projektech.
}

% Abstrakt (doporučený rozsah cca 80-200 slov; nejedná se o zadání práce)
\def\Abstrakt{%
Cílem této práce je vyvinout webovou aplikaci pro vyhledávání receptů založenou na agregaci datových sad z~existujících webových stránek s~recepty a~jejich obohacení o~data ze znalostních grafů. Znalostní grafy byly zastoupeny projekty DBpedia a Wikidata, z~nichž byla získána rozšiřující data o~ingrediencích. Data byla extrahována s~pomocí knihovny Apify pro web scraping a~v~dokumentovém modelu uložena do databázového systému Apache CouchDB. Aplikace uživateli poskytuje různé možnosti filtrování výsledků včetně fasetového vyhledávání, k~čemuž využívá platformu Apache Solr. Zaměřuje se zejména na vyhledávání dle ingrediencí. Jedná se o~tzv.~single-page aplikaci implementovanou pomocí knihovny React.js pro uživatelské rozhraní a~frameworku Express.js na straně serveru. Obě části aplikace jsou psány staticky typovaným jazykem TypeScript a~komunikují spolu prostřednictvím REST~API.
}
\def\AbstraktEN{%
This thesis aims to develop a web application for searching recipes. The search for recipes is based on aggregating datasets from the existing recipe websites and extending the data using knowledge graphs. Knowledge graphs were represented by DBpedia and Wikidata projects. These were used to gather data about ingredients. Data were extracted using the Apify web scraping library and stored in the database system Apache CouchDB using the document model. The application provides the user with different options for filtering results, including faceted search. Faceted search is implemented using the Apache Solr platform. The focus is on searching based on ingredients. The web application is a single-page application implemented using the React.js library at the frontend and the Express.js framework at the backend. Both parts of the application are written in statically typed language TypeScript and exchange information through REST API.
}

% 3 až 5 klíčových slov (doporučeno), každé uzavřeno ve složených závorkách
\def\KlicovaSlova{%
{webová aplikace}, {recept}, {znalostní graf}, {propojená data}
}
\def\KlicovaSlovaEN{%
{web app}, {recipe}, {knowledge graph}, {linked data}
}

%% Balíček hyperref, kterým jdou vyrábět klikací odkazy v PDF,
%% ale hlavně ho používáme k uložení metadat do PDF (včetně obsahu).
%% Většinu nastavítek přednastaví balíček pdfx.
\hypersetup{unicode}
\hypersetup{breaklinks=true}

%% Definice různých užitečných maker (viz popis uvnitř souboru)
\include{makra}

%% Titulní strana a různé povinné informační strany
\begin{document}
\include{titulka}

%%% Strana s automaticky generovaným obsahem bakalářské práce

\tableofcontents

%%% Jednotlivé kapitoly práce jsou pro přehlednost uloženy v samostatných souborech
\include{uvod}
\include{kap01}
\include{kap02}
\include{kap03}
\include{kap04}
\include{kap05}

\include{zaver}

%%% Seznam použité literatury
\include{literatura}

%%% Obrázky v bakalářské práci
%%% (pokud jich je malé množství, obvykle není třeba seznam uvádět)
\listoffigures

%%% Tabulky v bakalářské práci (opět nemusí být nutné uvádět)
%%% U matematických prací může být lepší přemístit seznam tabulek na začátek práce.
% \listoftables

%%% Přílohy k bakalářské práci, existují-li. Každá příloha musí být alespoň jednou
%%% odkazována z vlastního textu práce. Přílohy se číslují.
%%%
%%% Do tištěné verze se spíše hodí přílohy, které lze číst a prohlížet (dodatečné
%%% tabulky a grafy, různé textové doplňky, ukázky výstupů z počítačových programů,
%%% apod.). Do elektronické verze se hodí přílohy, které budou spíše používány
%%% v elektronické podobě než čteny (zdrojové kódy programů, datové soubory,
%%% interaktivní grafy apod.). Elektronické přílohy se nahrávají do SISu a lze
%%% je také do práce vložit na CD/DVD. Povolené formáty souborů specifikuje
%%% opatření rektora č. 72/2017.
\appendix
\chapter{Přílohy}

\section{Instalace a spuštění aplikace}

Konfiguraci aplikace rozdělíme do $3$ fází:

\begin{enumerate}
    \item Příprava dat
    \item Persistence dat
    \item Spuštění aplikace
\end{enumerate}

Předpokládá se nainstalovaný runtime Node.js pro vývoj v~jazyce JavaScript s výchozím správcem balíčků npm. Systémy Apache Solr a~Silk Workbench byly zprovozněny pomocí Dockeru jako samostatné kontejnery, je ale možné zvolit jiný způsob instalace. Ke zpracování dat receptů a~ingrediencí jsou přiloženy shellové skripty pro systémy Windows i~Linux. Počínaje konfiguračními skripty \texttt{build.bat}, respektive \texttt{build.sh}, z~adresáře \texttt{data} se rekurzivně volají skripty z~vnořených adresářů. Dále jsou připraveny skripty \texttt{run.bat} a~\texttt{run.sh} pro spuštění extrakce, konverze a~následného nahrání dokumentů do databáze. Jednotlivé JavaScriptové programy lze spouštět samostatně příkazem \texttt{node\,script.js}. Často budeme potřebovat spustit jen některé fáze, zejména extrakce bude vzhledem k~objemu dat výjimečnou záležitostí. Shellové skripty tak často poslouží spíše jako dokumentace správného pořadí jednotlivých skriptů. Konstanty potřebné pro konfiguraci jsou obvykle soustředěny v~souborech \texttt{constants.js} a~\texttt{config.js}. Jejich hodnoty lze přizpůsobit dle potřeby, například omezit počet receptů, které se mají extrahovat z~webové aplikace pomocí Apify actora.

\subsection{Příprava dat}

Předpokládáme následující nainstalované nástroje:

\begin{itemize}
    \item Python
    \item Apify CLI\footnote{https://www.npmjs.com/package/apify-cli/v/0.1.2}
    \item Silk Workbench\footnote{https://hub.docker.com/r/silkframework/silk-workbench}
\end{itemize}

V~rámci fáze extrakce a~předzpracování dat je potřeba stáhnout datovou sadu \emph{Food.com Recipes and~Interactions}\footnote{https://www.kaggle.com/datasets/shuyangli94/food-com-recipes-and-user-interactions} z~Kaggle. Soubory \texttt{RAW\underline{{ }}recipes.csv} a~\texttt{PP\underline{{ }}recipes.csv} patří do adresáře \texttt{data/resources/foodcom/recipes}. Dále je potřeba umístit \texttt{ingr\underline{{ }}map.csv} do \texttt{data/resources/foodcom/ingredients}. Následně jsou připraveny skripty pro konverzi a~extrakci dat z~webových aplikací Food.com a~Allrecipes. Pro spuštění \texttt{run-venv.bat}, eventuálně \texttt{run-venv.sh} uvnitř adresáře \texttt{data/resources/foodcom/ingredients} je potřeba mít aktivováno virtuální prostředí pro vývoj v~jazyce Python s~nainstalovanou knihovnou pickle.

Ve všech adresářích obsahujících soubor \texttt{package.json} je potřeba použít příkaz \texttt{npm\,install}. Inicializace Apify actorů v~adresářích \texttt{food-com-scraper} a~\texttt{allrecipes-scraper} se provede standardními příkazy \texttt{npm\,install} a~dále \texttt{apify\,init}, který vytvoří potřebné podadresáře včetně \texttt{apify\underline{{ }}storage}. Zejména adresáře s~actory jsou zcela nezávislé na kontextu zbytku aplikace, aby bylo co nejsnadnější je v případě potřeby migrovat na cloudovou platformu Apify, pro kterou jsou primárně určeny.

Dále je potřeba zkopírovat vygenerované datasety ingrediencí v RDF formátu Turtle z~adresářů \texttt{ingredients} do aplikace Silk Workbench a~vytvořit pro ně úlohy linkování s~otevřenými znalostními grafy DBpedia a~Wikidata. V~podadresářích \texttt{rdf-data} uvnitř adresářů \texttt{foodcom} a~\texttt{allrecipes} jsou uloženy konfigurační XML soubory vygenerované ze Silk Workbench. Pomocí nich je možné úlohu spustit z~příkazové řádky, naše řešení ale tohoto přístupu nevyužívá. Datasety s~propojenými entitami jsou očekávány v~adresářích \texttt{rdf-data} ve formátu N-triples.

\subsection{Persistence dat}

Předpokládáme nainstalovanou instanci systému Apache CouchDB s~platnými přihlašovacími údaji a~přístupem do administrace skrze webovou aplikaci \-Fauxton. Dále instalaci platformy Apache Solr s~vytvořeným jádrem \texttt{recipes}.

Extrahovaná a~vyčištěná data jsou ukládána do databáze CouchDB. Příslušné skripty a~konfigurační soubory najdeme v~adresáři \texttt{data/database} a~jsou volány pomocí automatizovaného skriptu \texttt{run} z~kořenového adresáře \texttt{data}. Heslo pro přihlášení do databáze je potřeba uložit jako proměnnou prostředí pod názvem \texttt{COUCHDB\underline{{ }}PASSWORD} nebo změnit nastavení v souboru \texttt{config.js}.

Následuje vytvoření indexů a~odpovídajících dokumentů receptů pro platformu Solr. Související skripty jsou v~adresáři \texttt{data/solr}. Dokumenty receptů jsou extrahovány přímo z~databáze CouchDB, což by mělo usnadnit situaci, kdy by instance CouchDB a~Solr běžely na různých zařízeních.

\subsection{Spuštění aplikace}

Kód aplikace je soustředěn v~adresáři \texttt{app}, který je dále rozdělen na \texttt{frontend} a~\texttt{backend}. K~inicializace obou částí aplikace stačí nainstalovat závislosti dle \texttt{package.json} pomocí \texttt{npm\,install}. Pro následné spuštění serverové části aplikace je potřeba spustit z~umístění \texttt{backend} příkazy \texttt{npm\,run\,build} pro automatickou transpilaci z~TypeScriptu do JavaScriptu a~\texttt{npm\,start} k~samotnému spuštění aplikace. Pro úspěšný start musí být k~dispozici CouchDB i~Solr na adresách specifikovaných v~příslušných souborech \texttt{config.js}. Single-page aplikaci lze spustit ve vývojářském módu pomocí \texttt{npm\,start} z~adresáře \texttt{frontend}. Veškeré změny v~kódu backendu i~frontendu se po uložení automaticky projeví v~aplikaci běžící ve webovém prohlížeči. Produkční verze aplikace je do adresáře \texttt{frontend/build} generována příkazem \texttt{npm\,run\,build}. Následně lze spustit pomocí \texttt{serve\,-s\,build}.

\pagebreak
\section{Hledání linků mezi datasety ingrediencí}

\begin{figure}[h!]\centering
\includegraphics[height=220mm]{../img/silk-workbench}
\caption{Grafické znázornění úlohy linkování v aplikaci Silk Workbench.}
\label{obr0a:silk-workbench}
\end{figure}

\section{Výsledky testování SUS}

Pro otestování UX designu naší aplikace jsme využili nástroj System Usability Scale neboli SUS \citep{sus-test}. Testujícím bylo zadáno $5$ jednoduchých úkolů uvedených v~kapitole o~testování, které simulovaly běžnou práci s~aplikací. Posledním úkolem bylo zodpovědět $10$ standardizovaných otázek dle SUS dotazníku na škále od $1$~do $5$, kde $1$~představuje \uv{silně nesouhlasím} a~$5$~naopak \uv{silně souhlasím}. 

\subsection{Formát dotazníku}
Otázky jsme dle vzoru z~anglického zdroje zformulovali následovně \citep{sus-adobe}:

\begin{enumerate}
    \item Myslím, že bych rád aplikaci využíval pravidelně.
    \item Aplikace mi připadá zbytečně složitá.
    \item S aplikací se mi pracovalo snadno.
    \item Myslím, že bych potřeboval technickou podporu.
    \item Myslím, že funkce byly v aplikaci dobře integrovány.
    \item Zdá se mi, že aplikace byla příliš nekonzistentní.
    \item Domnívám se, že většina lidí by se naučila aplikaci používat velmi rychle.
    \item Ovládání aplikace mi připadalo dost těžkopádné.
    \item Při používání aplikace jsem se cítil velmi jistý.
    \item Musel jsem se naučit hodně věcí, než jsem mohl začít aplikaci používat.
\end{enumerate}

\subsection{Postup výpočtu skóre}

Algoritmus výpočtu skóre je následující \citep{sus-adobe}:

\begin{enumerate}
    \item Zvol proměnnou $X$ jako součet celkového skóre otázek s lichým pořadím snížený o hodnotu $5$.
    \item Zvol proměnnou $Y$ jako výsledek celkového skóre otázek se sudým pořadím odečtený od $25$.
    \item Sečti hodnoty proměnných $X$, $Y$ a výsledek vynásob koeficientem $2,5$.
\end{enumerate}

Odpověď na $i$-tou lichou otázku označme $a_i$ a na $j$-tou sudou otázku $a_j$.

$X := \sum a_i$ pro $i \in \{1,3,5,7,9\}$

$Y := \sum a_j$ pro $j \in \{2,4,6,8,10\}$

$Z := ( \,X + Y\,)\,\cdot\,2,5$

\subsection{Výpočet skóre}

Odpovědi vyjádříme pomocí uspořádaných $10$-tic s~prvky v~pořadí od $1$.~do $10$. odpovědi a~s~indexem odpovídajícím pořadí respondenta. Celkem dotazník zodpověděli $4$ respondenti.

\subsubsection{První respondent}

$v_1 := (\,4,1,4,1,5,2,5,1,5,1\,)$

$X_1 := (\,4 + 4 + 5 + 5 + 5\,) - 5 = 18\,$

$Y_1 := 25 - (\,1 + 1 + 2 + 1 + 1\,) = 19\,$

$Z_1 := ( \,18 + 19\,)\,\cdot\,2,5 = 92,5$

\subsubsection{Druhý respondent}

$v_2 := (\,4,2,5,1,4,1,5,1,5,1\,)$

$X_2 := (\,4 + 5 + 4 + 5 + 5\,) - 5 = 18\,$

$Y_2 := 25 - (\,2 + 1 + 1 + 1 + 1\,) = 19\,$

$Z_2 := ( \,18 + 19\,)\,\cdot\,2,5 = 92,5$

\subsubsection{Třetí respondent}

$v_3 := (\,5,2,5,1,5,1,5,1,4,1\,)$

$X_3 := (\,5 + 5 + 5 + 5 + 4\,) - 5 = 19\,$

$Y_3 := 25 - (\,2 + 1 + 1 + 1 + 1\,) = 19\,$

$Z_3 := ( \,19 + 19\,)\,\cdot\,2,5 = 95$

\subsubsection{Čtvrtý respondent}

$v_4 := (\,4,2,4,1,5,1,5,1,5,1\,)$

$X_4 := (\,4 + 4 + 5 + 5 + 5\,) - 5 = 18\,$

$Y_4 := 25 - (\,2 + 1 + 1 + 1 + 1\,) = 19\,$

$Z_4 := ( \,18 + 19\,)\,\cdot\,2,5 = 92,5$

\subsubsection{Průměrné skóre}

Finální hodnocení $R$ vypočteme jako průměr výsledků jednotlivých respondentů:

$R := \frac{Z_1 + Z_2 + Z_3 + Z_4}{4} = \frac{(\,92,5\,\cdot\,3\,)\,+\,95}{4} = 93,125$

\section{Digitální příloha}

K~práci je v~adresáři \texttt{BP\underline{{ }}LhotanovaKristyna.zip} přiložen zdrojový kód a~vygenerovaná API dokumentace komponent frontendu. Kód je rozdělen do adresářů \texttt{app} pro samotnou aplikaci a~\texttt{data} pro extrakci a~přípravu dat. Aktuální verze aplikace je veřejně k~dispozici na platformě GitHub ve vzdáleném adresáři \texttt{MeaLinker}\footnote{https://github.com/lhotanok/MeaLinker}. Statická HTML dokumentace je v~příloze uložena v~adresáři \texttt{docs} a~dále je publikovaná na stránce GitHub Pages dostupné z~GitHub adresáře projektu.

\openright
\end{document}
